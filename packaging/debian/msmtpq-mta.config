#!/bin/sh

set -e


if [ -e /usr/share/debconf/confmodule ] ; then
	. /usr/share/debconf/confmodule
fi

config_to_debconf () {
	if [ -f /etc/msmtpqrc ]; then
		var=$(grep ^$1 /etc/msmtpqrc | awk '{ print $2 }')
		if [ "x$var" = "xon" ]; then
			db_set shared/msmtpq/$1 true
		elif [ "x$var" != "x" ]; then
			db_set shared/msmtpq/$1 $var
		fi
	fi
	db_input $2 shared/msmtpq/$1 || true
	db_go
}

if [ -f /etc/msmtpq ]; then
	db_set shared/msmtpq/sysconfig true
else
	db_input medium shared/msmtpq/sysconfig || true
	db_go
fi

db_get shared/msmtpq/sysconfig
if [ "$RET" = "false" ]; then
	exit 0
else

	config_to_debconf host high

	config_to_debconf port low

	config_to_debconf auto_from medium

	db_get shared/msmtp-bin/auto_from
	if [ "$RET" = "true" ] ; then
		config_to_debconf maildomain medium
	fi

	config_to_debconf tls low
fi

db_stop

